{"version":3,"file":"uppy-qiniu-uploader.esm.js","sources":["../src/index.js"],"sourcesContent":["import Plugin from 'uppy/lib/core/Plugin'\nimport * as qiniu from 'qiniu-js'\nexport default class Qiniu extends Plugin {\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = opts.id || 'Qiniu'\n    this.type = 'uploader'\n    this.getToken = opts.getToken || (() => {})\n    this.host = opts.host || ''\n    this.Uploader = this.Uploader.bind(this)\n  }\n  uploadFiles (files) {\n    const me = this\n    const filesPromise = files.map(file => {\n      return new Promise((resolve, reject) => {\n        const observable = qiniu.upload(file.data, file.name, this.getToken())\n        const observer = {\n          next (res) {\n            me.uppy.emit('upload-progress', file, {\n              uploader: me,\n              bytesUploaded: res.total.loaded,\n              bytesTotal: res.total.size\n            })\n          },\n          error (err) {\n            reject(err)\n          },\n          complete (res) {\n            me.uppy.emit('upload-success', file, res, me.host + '/' + res.key)\n            resolve()\n          }\n        }\n        observable.subscribe(observer)\n        me.uppy.emit('upload-started', file)\n      })\n    })\n    return Promise.all(filesPromise)\n  }\n  Uploader (fileIDs) {\n    const files = fileIDs.map(fileID => this.uppy.getFile(fileID))\n    return this.uploadFiles(files)\n  }\n  install () {\n    this.uppy.addUploader(this.Uploader)\n  }\n  uninstall () {\n    this.uppy.removeUploader(this.Uploader)\n  }\n}\n"],"names":["Qiniu","uppy","opts","id","type","getToken","host","Uploader","bind","uploadFiles","files","me","filesPromise","map","resolve","reject","observable","qiniu","file","data","name","observer","res","emit","total","loaded","size","err","key","subscribe","all","fileIDs","getFile","fileID","install","addUploader","uninstall","removeUploader","Plugin"],"mappings":";;;;;;;;;;;;;;;;IAEqBA;;;iBACNC,IAAb,EAAmBC,IAAnB,EAAyB;;;iDACvB,mBAAMD,IAAN,EAAYC,IAAZ,CADuB;;UAElBC,EAAL,GAAUD,KAAKC,EAAL,IAAW,OAArB;UACKC,IAAL,GAAY,UAAZ;UACKC,QAAL,GAAgBH,KAAKG,QAAL,IAAkB,YAAM,EAAxC;UACKC,IAAL,GAAYJ,KAAKI,IAAL,IAAa,EAAzB;UACKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,OAAhB;;;;kBAEFC,mCAAaC,OAAO;;;QACZC,KAAK,IAAX;QACMC,eAAeF,MAAMG,GAAN,CAAU,gBAAQ;aAC9B,aAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;YAChCC,aAAaC,MAAA,CAAaC,KAAKC,IAAlB,EAAwBD,KAAKE,IAA7B,EAAmC,OAAKf,QAAL,EAAnC,CAAnB;YACMgB,WAAW;cAAA,gBACTC,GADS,EACJ;eACNrB,IAAH,CAAQsB,IAAR,CAAa,iBAAb,EAAgCL,IAAhC,EAAsC;wBAC1BP,EAD0B;6BAErBW,IAAIE,KAAJ,CAAUC,MAFW;0BAGxBH,IAAIE,KAAJ,CAAUE;aAHxB;WAFa;eAAA,iBAQRC,GARQ,EAQH;mBACHA,GAAP;WATa;kBAAA,oBAWLL,GAXK,EAWA;eACVrB,IAAH,CAAQsB,IAAR,CAAa,gBAAb,EAA+BL,IAA/B,EAAqCI,GAArC,EAA0CX,GAAGL,IAAH,GAAU,GAAV,GAAgBgB,IAAIM,GAA9D;;;SAZJ;mBAgBWC,SAAX,CAAqBR,QAArB;WACGpB,IAAH,CAAQsB,IAAR,CAAa,gBAAb,EAA+BL,IAA/B;OAnBK,CAAP;KADmB,CAArB;WAuBO,SAAQY,GAAR,CAAYlB,YAAZ,CAAP;;;kBAEFL,6BAAUwB,SAAS;;;QACXrB,QAAQqB,QAAQlB,GAAR,CAAY;aAAU,OAAKZ,IAAL,CAAU+B,OAAV,CAAkBC,MAAlB,CAAV;KAAZ,CAAd;WACO,KAAKxB,WAAL,CAAiBC,KAAjB,CAAP;;;kBAEFwB,6BAAW;SACJjC,IAAL,CAAUkC,WAAV,CAAsB,KAAK5B,QAA3B;;;kBAEF6B,iCAAa;SACNnC,IAAL,CAAUoC,cAAV,CAAyB,KAAK9B,QAA9B;;;;EA5C+B+B;;;;"}